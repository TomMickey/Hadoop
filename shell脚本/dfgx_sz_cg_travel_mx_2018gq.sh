#!/bin/bash

hive -e "
	set mapreduce.job.name='深圳本地国外游-获取出国游所有数据';
	use dfgx_tour_db;
	insert overwrite table dfgx_tour_db.dfgx_sz_cg_travel_mx_2018gq SELECT z.msisdn,z.roam_type,z.visit_area_code,z.start_date FROM (SELECT a.msisdn,a.roam_type,a.visit_area_code,a.start_date FROM (SELECT msisdn,roam_type,visit_area_code,start_date FROM yx_details.tg_cdrmm_ss WHERE (source_day>='20180901' AND source_day<='20180905')) a JOIN dfgx_tour_db.dfgx_sz_to_foreign_travel_2018gq b  ON a.msisdn=b.msisdn UNION all SELECT c.msisdn, c.roam_type,c.visit_area_code,c.start_date FROM   (SELECT msisdn, roam_type,visit_area_code,start_date FROM yx_details.tg_cdrmm_gs_ss WHERE (source_day>='20180901'  AND source_day<='20180905')) c JOIN dfgx_tour_db.dfgx_sz_to_foreign_travel_2018gq d ON c.msisdn=d.msisdn UNION all SELECT e.msisdn, e.roam_type, e.visit_area_code, e.start_date  FROM  (SELECT msisdn, roam_type, visit_area_code, start_date  FROM yx_details.ods_tg_cdrmm_gs_23g WHERE ((source_day>='h20180901'  AND source_day<='h20180905') OR (source_day>='y20180901' AND source_day<='y20180905'))) e  JOIN dfgx_tour_db.dfgx_sz_to_foreign_travel_2018gq f  ON e.msisdn=f.msisdn UNION all SELECT g.msisdn, g.roam_type, g.visit_area_code,g.start_date FROM   (SELECT msisdn,roam_type, visit_area_code,start_date FROM yx_details.ods_tg_cdrmm_23g WHERE ((source_day>='h20180901' AND source_day<='h20180905')  OR (source_day>='y20180901'  AND source_day<='y20180905'))) g JOIN dfgx_tour_db.dfgx_sz_to_foreign_travel_2018gq h  ON g.msisdn=h.msisdn UNION all SELECT i.isdn AS msisdn,'8' AS roam_type,'国内' AS visit_area_code,concat(i.year,lpad(i.month,2,0),lpad(i.day,2,0)) AS start_date  FROM  (SELECT isdn, year, month, day FROM dfgx_tour_db.dfgx_brd_sdtp  WHERE concat (deal_year,lpad(deal_month,2,0),lpad (deal_day,2,0))>='20180901'  AND concat(deal_year,lpad(deal_month,2,0),lpad(deal_day,2,0))<='20180905') i JOIN dfgx_tour_db.dfgx_sz_to_foreign_travel_2018gq j ON i.isdn=j.msisdn) z GROUP BY  z.msisdn,z.roam_type,z.visit_area_code,z.start_date;
"